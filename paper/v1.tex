\documentclass[prd,amsmath,amssymb,floatfix,superscriptaddress,nofootinbib,twocolumn]{revtex4-1}

\def\be{\begin{equation}}
\def\ee{\end{equation}}
\def\bea{\begin{eqnarray}}
\def\eea{\end{eqnarray}}
\newcommand{\C}{\rm C}
\newcommand{\LC}{\rm LC}
\newcommand{\ini}{\rm ini}
\newcommand{\vbk}{\vec{\bar{k}}}
\newcommand{\vq}{\vec{q}}
\newcommand{\vrr}{\vec{r}}
\newcommand{\vbkp}{\vec{\bar{k'}}}
\newcommand{\bk}{{\bar{k}}}
\newcommand{\vs}{\nonumber\\}
\newcommand{\Var}{\rm Var}
\newcommand{\vk}{\vec{k}}
\newcommand{\ec}[1]{Eq.~(\ref{eq:#1})}
\newcommand{\eec}[2]{Eqs.~(\ref{eq:#1}) and (\ref{eq:#2})}
\newcommand{\Ec}[1]{(\ref{eq:#1})}
\newcommand{\eql}[1]{\label{eq:#1}}
\newcommand{\rf}[1]{\ref{fig:#1}}
\newcommand{\sfig}[2]{
\includegraphics[width=#2]{../plots/#1}
        }
%\newcommand{\sfigg}[2]{
%\includegraphics[width=0.424\paperwidth]{../plots/#1}
%        }
\newcommand{\sfigg}[2]{
\includegraphics[width=#2]{../plots/#1}
        }
\newcommand{\sfiggg}[2]{
\includegraphics[width=0.4\paperwidth]{../plots/#1}
        }
\newcommand{\sfigr}[2]{
\includegraphics[angle=270,origin=c,width=#2]{#1}
        }
\newcommand{\sfigra}[2]{
\includegraphics[angle=90,origin=c,width=#2]{#1}
        }
\newcommand{\Sfig}[2]{
   \begin{figure}[thbp]
   \begin{center}
    \sfig{../plots/#1.pdf}{\columnwidth}
    \caption{{\small #2}}
    \label{fig:#1}
     \end{center}
   \end{figure}
}
\newcommand{\Sfigg}[2]{
   \begin{figure}[thbp]
    \sfigg{../plots/#1.pdf}{.8\paperwidth}
    \caption{{\small #2}}
    \label{fig:#1}
   \end{figure}
}
\newcommand{\Spng}[2]{
   \begin{figure}[thbp]
   \begin{center}
    \sfigg{../plots/#1.png}{\columnwidth}
    \caption{{\small #2}}
    \label{fig:#1}
     \end{center}
   \end{figure}
}
\usepackage{calligra}
\DeclareMathAlphabet{\mathcalligra}{T1}{calligra}{m}{n}
\DeclareMathAlphabet{\mathpzc}{OT1}{pzc}{m}{it}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{simplewick}
\usepackage{amsmath}
\usepackage{bm}
\usepackage{color}
\usepackage{enumitem}
\usepackage[linktocpage=true]{hyperref} 
\hypersetup{
    colorlinks=true,       
    linkcolor=red,         
    citecolor=blue,        
    filecolor=magenta,      
    urlcolor=blue           
}
\usepackage[all]{hypcap} 
\definecolor{darkgreen}{cmyk}{0.85,0.1,1.00,0} 
\definecolor{darkorange}{rgb}{1.0,0.2,0.0}
\newcommand{\scott}[1]{{\color{darkgreen} #1}}
\newcommand{\peikai}[1]{{\color{blue} #1}}
\newcommand{\prvs}[1]{{\color{magenta} #1}}
\newcommand{\AL}[1]{{\color{magenta} AL: #1}}
\newcommand{\MR}[1]{{\color{blue} MR: #1}}
\newcommand{\RC}[1]{{\color{darkorange} #1}}
\newcommand{\nl}{\\ \indent}
\begin{document}
\title{Large Scale Structure Reconstruction with Short-Wavelength Modes: \\Halo Bias and Light Cone Formalism}
\author{\large Peikai Li}
\affiliation{Department of Physics, Carnegie Mellon University, Pittsburgh, PA 15213, USA}
\affiliation{McWilliams Center for Cosmology, Carnegie Mellon University, Pittsburgh, PA 15213, USA}
\author{\large Scott Dodelson}
\affiliation{Department of Physics, Carnegie Mellon University, Pittsburgh, PA 15213, USA}
\affiliation{McWilliams Center for Cosmology, Carnegie Mellon University, Pittsburgh, PA 15213, USA}
\author{\large Rupert A. C. Croft}
\affiliation{Department of Physics, Carnegie Mellon University, Pittsburgh, PA 15213, USA}
\affiliation{McWilliams Center for Cosmology, Carnegie Mellon University, Pittsburgh, PA 15213, USA}

\date{\today}
\begin{abstract}
\noindent This is the second paper in a series where we propose a method of indirectly measuring large scale structure using information of small scale perturbations. The idea is to use two-point off-diagonal terms of density contrast modes to build a quadratic estimator for long-wavelength modes. We demonstrate in the first paper that our quadratic estimator works well on a dark-matter-only N-body simulation of the snapshot $z=0$. Here we generalize our theory to the case of a light-cone with halo bias taken into consideration. We successfully apply our generalized version of quadratic estimator to a light cone halo catalog of a N-body simulation of size $\sim5.6\,(h^{-1}\,\rm Gpc)^3$. The most distant point in the light cone is at a redshift of $1.4$, which indicates that we might be able to apply our method in the next generation galaxy surveys.
\end{abstract}
\maketitle
\section{Introduction}
\noindent Directly measuring the distribution of matter on large scales is nearly impossible right now as pointed out by \cite{Modi:2019hydr}. In our first work \cite{Li:2020fir}, we proposes a method of indirectly measuring large scale structure using small scale information. Physically, long- and short-wavelength modes are correlated in the sense that small scale modes will grow differently depending on the large scale structure they reside in. Mathematical feature of this phenomena is that the two-point statistics of short-wavelength matter density modes will have non-zero off-diagonal terms proportional to long-wavelength modes. This is our starting point of constructing the quadratic estimator for long-wavelength modes. We test the power of the quadratic estimator using a dark-matter-only catalog from an N-body simulation in the first paper. In this work, we generalize our theory to a halo catalog within a light cone for observational requirements.

First need to account for halo bias \cite{Kravtsov:1999hb}\cite{Desjacques:2018rev} since eventually we want to apply the estimator to future cosmological surveys \cite{LSST:2012ls}\cite{Wfirst:2012jg}\cite{DESI:2019ds}. Halo bias is a term relating halo number density perturbation to matter density perturbation. \peikai{fill in}

Observationally the halo/galaxy catalog will be in a light cone \cite{Carroll:1997gr} instead of a snapshot. Typically treatment is to cut a light cone into several thin redshift bins \peikai{need some citations here, can't find a proper one}, and analyze the properties within each bin. By doing this we will lose information about long-wavelength modes along line of sight. Thus in this paper we propose a novel method of considering all the halos/galaxies in a light cone together, despite redshift difference, simply by multiplying an extra function proportional to the inverse of linear growth function. Since the universe is linear on sufficiently large scales, two linear order matter density modes at different redshifts will still be correlated. With this knowledge we can recover linear power spectrum on large scales from our construction. Assuming a cube volume, we can construct the quadratic estimator for long-wavelength modes using information of non-zero off-diagonal terms like what we did before.

We begin with our treatment of halo bias in a snapshot by constructing the approximated form of matter perturbation field using information of halo positions. We then deal with matter density contrast in a light cone and then build the quadratic estimator. Finally we apply the estimator to different N-body simulations and successfully extract large scale modes both in a snapshot and in a light cone.

\section{Halo Bias}
\noindent Let's first do a quick review of how we construct the quadratic estimator of a dark-matter-only catalog \cite{Li:2020fir} before we get to a halo catalog. Starting from the perturbative series of matter density contrast in fourier space \cite{Jain:1994sop}\cite{Bernardeau:2002rev}:
\bea
&&\delta_{\rm m}(\vk;a)=\delta^{(1)}_{\rm m}(\vk;a)+\delta^{(2)}_{\rm m}(\vk;a)+\cdots\vs
&=&\frac{D_1(a)}{D_{\rm ini}}\delta^{(1)}_{\rm m}(\vk;a_{\ini})+\bigg[\frac{D_1(a)}{D_{\rm ini}}\bigg]^2\delta^{(2)}_{\rm m}(\vk;a_{\ini})+\cdots \eql{tayl}
\eea 
where 'm' stands for matter and $\delta_{\rm m}(\vk;a)$ is the full fourier space matter density contrast in a snapshot of cosmological growth factor $a$. $D_1$ is the linear growth facto while $D_{\ini} = D_1(a=a_{\ini})$ is the value of $D_1$ at some initial time $a_{\rm ini}$. By computing the off-diagonal term $\langle \delta_{\rm m}^{(1)}(\vk;a) \delta_{\rm m}^{(2)}(\vk;a) \rangle$ we can prove the following relation of the two-point function of two short-wavelength modes:
\be
\langle {\delta}_{\rm m}(\vec{k}_s;a){\delta}_{\rm m}(\vec{k}_s';a) \rangle =f(\vec{k}_s,\vec{k}_s'){\delta}^{(1)}_{\rm m}(\vec{k}_l;a) \eql{2pt}
\ee 
here $\vk_s$ and $\vk_s'$ are two short-wavelength modes and $\vk_l$ is a long-wavelength mode ($\vk_s,\vk_s' \gg \vk_l$). They satisfiy the squeezed-limit condition $\vk_s+\vk_s'=\vk_l$. $f$ is given by:
\bea
f(\vec{k}_s,\vec{k}_s')&=&2F_2(-\vec{k}_s,\vec{k}_s+\vec{k}_s')P_{\rm m,lin}(k_s;a)\vs
&+&2F_2(-\vec{k}_s',\vec{k}_s+\vec{k}_s')P_{\rm m,lin}(k_s';a)       
\eea 
$P_{\rm m,lin}$ is the linear matter power spectrum; $F_{2}$ is a function extremely insensitive to the choice of cosmological parameters in a dark-energy-dominated universe \cite{Takahashi:2008to} with expression:
\be
F_{2}(\vk_1,\vk_2)=\frac{5}{7}+\frac{2}{7}\frac{(\vk_1\cdot \vk_2)^2}{k_1^2 k_2^2}+\frac{\vk_1\cdot \vk_2}{2k_1k_2}\bigg[\frac{k_1}{k_2}+\frac{k_2}{k_1}\bigg].\eql{f2}
\ee
\ec{2pt} indicates that we can estimate long-wavelength modes using small scale information using the following minimum variance quadratic estimator:
\begin{eqnarray}
\hat{\delta}^{(1)}_{\rm m}(\vec{k}_l;a)=A(\vec{k}_l)\int \frac{d^3 \vec{k}_s}{(2\pi)^3} g(\vec{k}_s,\vec{k}_s'){\delta}_{\rm m}(\vec{k}_s;a){\delta}_{\rm m}(\vec{k}_s';a)\vs \eql{quadest}
\end{eqnarray} 
with $\vk_s'=\vk_l-\vk_s$. $A$ is the normalization factor defined by requiring that $\langle \hat{\delta}_{\rm m}^{(1)}(\vec{k}_l;a) \rangle={\delta}_{\rm m}^{(1)}(\vec{k}_l;a)$. $g$ is given by minimizing noise term. They can be expressed as:
\begin{eqnarray}
A(\vec{k}_l)&=&\bigg[\int \frac{d^3 \vec{k}_s}{(2\pi)^3} g(\vec{k}_s,\vec{k}_s')f(\vec{k}_s,\vec{k}_s')  \bigg]^{-1} \eql{a} \vs
g(\vec{k}_{s},\vec{k}_{s}')&=&\frac{f(\vec{k}_{s},\vec{k}_{s}')}{2P_{\rm m,nl}(k_{s})P_{\rm m,nl}(k_{s}')}
\end{eqnarray}
here $P_{\rm m,nl}$ is the nonlinear matter power spectrum. With this choice of the weighting function $g$, the Gaussian noise term is equal to the normalization factor $N(\vk_l)=A(\vk_l)$. And the projected probability of a power spectrum measurement using this quadratic estimator can be written as:
\be
\frac{1}{\sigma^{2}(k_l)}=\frac{V k_l^2 \Delta k }{(2\pi)^2}\bigg[\frac{P_{\rm m,lin}(k_l)}{P_{\rm m,lin}(k_l)+A(k_l) }\bigg]^2 \eql{error},
\ee
where $V$ is the volume of a survey. We also take advantage of the fact that $A(\vk_l)$ does not depend on the direction of the long mode $\vk_l$.

By far we have finished reviewing the general formalism of the large scale quadratic estimator in a dark-matter-only catalog. Now we generalize it to a halo catalog.

Ignoring higher order halo bias, the density contrast of halos can be related to that of matter at a fixed time $a$ as \cite{Desjacques:2018rev}:
\be 
\delta_{\rm h}(\vrr;a) \equiv \frac{n_{\rm n}(\vrr;a)-\bar{n}_{\rm h}(a)}{\bar{n}_{\rm h}(a)}=b_{1}\delta_{\rm m}(\vrr;a) \eql{hdc}
\ee 
here '$\rm h$' means 'halo' while '$\rm m$' stands for 'matter'. $n_{\rm h}$ is the halo number density field at a given position and $\bar{n}_{\rm h}$ is the mean number density of halos. $b_{1}$ is the linear bias parameter relating halo and matter density contrasts. Linear bias is a function of halo mass and position and has been well approximated using analytical expressions\cite{Seljak:2004SW}\cite{Bhattacharya:2011MF}. We will use Tinker halo bias function throughout this paper\cite{Tinker:2010Tinker}. Halo density contrast in \ec{hdc} can be explicitly written as:
\be 
\delta_{\rm h}(\vrr;a) \equiv \frac{\sum_{i=1}^{N_{\rm h}}\delta_{\rm D}(\vrr-\vrr_{i})-N_{\rm h}/V}{N_{\rm h}/V}\bigg|_{a}
\ee 
here $\delta_{\rm D}$ is the Dirac delta function. $N_{\rm h}$ is the total number of halos. Since the linear bias $b_1$ depends not only on halo mass but also halo redshift, it will be more challenging for us to use $\delta_{\rm h}$ than $\delta_{\rm m}$ within a light cone \ref{sec2}. Here we build an approximated matter density contrast out of halo positions following \cite{Pervical:2007GPS}:
\be 
\delta_{\rm m}(\vrr) \equiv \frac{\sum_{i=1}^{N_{\rm h}}\frac{\delta_{\rm D}(\vrr-\vrr_{i})}{b_{1}(M_{i},a_{i})}-\sum_{i=1}^{N_{\rm h}}\frac{1}{b_{1}(M_{i},a_{i})\,V}}{N_{\rm h}/V}\bigg|_{a} \eql{hm}
\ee 
$a_{i}$ is the cosmological growth factor of the $i$-th halo. In this section we can use the simplification $b_{1}(M_{i},a_{i})=b_{1}(M_i)$ since we only consider a fixed time. We consider \ec{hm} as a general formula of expressing matter density using the distribution of halos only, since in real surveys the bias can be expressed as a function of luminosity and color \cite{Cresswell:2008Col}. We will not use halo density contrast $\delta_{\rm h}$ directly, instead we will use $\delta_{\rm m}$ defined in \ec{hm} as the approximated matter density contrast during the calculation of the quadratic estimator \ec{quadest} both for a snapshot and for a light cone.

\section{Demonstration with N-body simulation I} \label{sec5}
\noindent We test the power of the quadratic estimator using a halo catalog from a cosmological N-body simulation. We use the $z=0$ snapshot from BigMDPL, one of the Multi-Dark cosmological simulations \cite{Klypin:2014nov}. This simulation used a flat $\Lambda$CDM model with Planck Collaboration XVI (2014) \cite{Planck:2014cos} cosmological parameters. Halos were found in this catalog using \textit{Rockstar} code \cite{Behroozi:2013Rock}. We will focus on halos with masses between $5 \times 10^{12}h^{-1}M_{\odot}<M < 10^{13}h^{-1}M_{\odot}$ for simplicity. And we have similar results in other mass bins as well.

We use the approximated density contrast defined in \ec{hm} and it is able to perfectly capture the nonlinear matter power spectrum. Thus the projected detectability will be the same as our last our, shown in Fig.~\rf{SN_BIGMDPL}.

\Sfig{SN_BIGMDPL}{Long-wavelength power spectrum and its error from \ec{error} which can be expressed as $P_{\rm m, lin}(k_l)\sigma(k_l)$. Boxsize of the survey is assumed to be $L=2.5\, h^{-1}\rm\, Gpc$ thus volume $V=L^3$ and width $\Delta k = 2\pi/L$. The integration range for $\vk_s$ is from $0.03 \,h \,\rm Mpc^{-1}$ to $0.22\,h\,\rm Mpc^{-1}$.}

We also transform the true Fourier modes $\delta_{\rm m}(\vk_l)$ and the estimated long-wavelength modes $\hat{\delta}_{\rm m}(\vk_l)$ back into real space and compare them in Fig.~\rf{real_snap}. We can see that this quadratic estimator is able to successfully recapture large scale over/under densities. 
 
\Sfig{real_snap}{Comparison of the true density field of the BigMDPL halo catalog within mass bin $5 \times 10^{12}h^{-1}M_{\odot}<M < 10^{13}h^{-1}M_{\odot}$ ($\delta_{\rm m}(\vrr)$ computed using the directly measured large scale modes, top row) and the density field from the quadratic estimator ($\hat{\delta}_{\rm m}(\vrr)$, middle row). The bottom row shows their difference. Each panel represents a slice through the simulation volume, $2500\,h^{-1}\rm \, Mpc$ wide, and one cell $\sim 357\,h^{-1}\rm \, Mpc$ thick. The integration range of $\vk_{s}$ is from $0.03\, h \rm \, Mpc^{-1}$ to $0.22\, h \rm \, Mpc^{-1}$.}

\section{Light Cone Formalism} \label{sec2}
We define the matter density contrast in a light cone as the usual matter density times the inverse of linear growth function, to compensate the large scale lack of growth at higher redshifts:
\be
\delta^{\LC}_{\rm m}(\vrr) :=\delta_{\rm m}(\vrr) \frac{D_{\ini}}{D_{1}(a(r))} \eql{LC}
\ee
where $\LC$ stands for "light cone". We set $a(\vrr=0)$ to be the origin of the light cone thus $a(\vrr)=a(r)$ will not depend of the direction of position $\vrr$. $\delta_{\rm m}(\vrr)$ is the matter density perturbation at location $\vrr$ with redshift $1/(1+a(r))$. Consider the fourier transform of this density contrast:
\be
\delta^{\LC}_{\rm m}(\vk) =\int_{V} d^3\vrr  \, \delta_{\rm m}(\vrr) \frac{D_{\ini}}{D_{1}(a(r))}  e^{-i\vk \cdot\vrr} \eql{LCM}
\ee
$V$ is the whole volume of the light cone. We can write the real space matter inhomogeneity field $\delta_{\rm m}(\vrr)$ as:
\be
\delta_{\rm m}(\vrr)=\delta_{\rm m}(\vrr;a(r))=\int \frac{d^3 \vk}{(2\pi)^3}e^{i\vk\cdot\vrr}\delta_{\rm m}(\vk;a(r))\eql{snp}
\ee 
$\delta_{\rm m}(\vrr)$ is the density contrast at location $\vrr$ of the \textbf{light cone}; while $\delta_{\rm m}(\vrr;a(r))$ is the density contrast at location $\vrr$ of the \textbf{snapshot} at time $a(r)$. \ec{snp} is the inverse Fourier transform of modes $\delta_{\rm m}(\vk;a(r))$ at a \textbf{fixed} time $a(r)$. If we further transform it back we would get:
\be 
\delta_{\rm m}(\vk;a(r))=\int \frac{d^3 \vrr}{(2\pi)^3}e^{-i\vk\cdot\vrr}\delta_{\rm m}(\vrr;\underbrace{a(r)}_{\rm fixed})
\ee 
here the range of the integration is the whole space of that \textbf{snapshot}. Thus this equation still holds because we perform the calculation at a \textbf{fixed} time $a(r)$. We have the usual perturbative expansion of modes $\delta_{\rm m}(\vbk;a(r))$ and the time evolution of each order in \ec{tayl}.

Similar to our previous work, we still want to compute the off-diagonal term of $\delta^{\LC}_{\rm m}(\vk)$ up to second order. And the first and second order term of $\delta^{\LC}_{\rm m}(\vk)$ will be:
\be 
\delta^{\LC,(\rm i)}_{\rm m}(\vk)=\int_{V} d^3\vrr  \, \int \frac{d^3 \vbk}{(2\pi)^3}e^{i(\vbk-\vk)\cdot\vrr}\delta^{(\rm i)}_{\rm m}(\vbk;a(r))\frac{D_{\ini}}{D_{1}(a(r))}  \eql{exp}
\ee 
with $i=1,2$. They are defined simply by substituting the first and second order term of \ec{snp} into \ec{LCM}. It's easy to prove that the first order term of $\delta^{\LC}_{\rm m}$ satisfies the following relation:
\be 
\langle \delta^{\LC,(\rm 1)}_{\rm m}(\vk) \delta^{\LC,(\rm 1)}_{\rm m}(\vk') \rangle = (2\pi)^3 \delta_{\rm D}(\vk+\vk')P_{\rm m,ini}(k)\eql{lps}
\ee 
with $\delta_{\rm D}$ being the Dirac delta function. This relation tells us that the first order term (which corresponds to long-wavelength modes) still characterizes the linear evolution information of the light cone, since redshift difference in the light cone has been cancelled by the extra factor $D_{\ini}/D_{1}(a(r))$ of the integrand.

To further generalize this formalism to a light cone halo catalog, we simply adopt the approximated matter density contrast defined in \ec{hm}. Notice in this case, the linear bias is also a function of halo redshift.

\section{Quadratic Estimator}
Using expressions of \ec{exp}, we can compute the two-point correlation of two short-wavelength modes $\delta^{\LC}_{\rm m}(\vk_s)$ and $\delta^{\LC}_{\rm m}(\vk_s')$. Again we take the squeezed limit $\vk_l=\vk_s+\vk_s'$:
\bea 
 &&\langle \delta^{\LC}_{\rm m}(\vk_s)\delta^{\LC}_{\rm m}(\vk_s') \rangle|_{\vk_s+\vk_s'=\vk_l}\vs
 =&&\langle \delta^{\LC,(1)}_{\rm m}(\vk_s)\delta^{\LC,(2)}_{\rm m}(\vk_s') \rangle+\langle \delta^{\LC,(2)}_{\rm m}(\vk_s)\delta^{\LC,(1)}_{\rm m}(\vk_s') \rangle \vs \eql{2p}
\eea 
Substituting \ec{exp} into \ec{2p} and evaluate the first bracket as an example:
\bea 
&&\langle \delta^{\rm LC,(1)}_{\rm m}(\vk_s)\delta^{\rm LC,(2)}_{\rm m}(\vk_s') \rangle \vs 
&=& \int_V d^{3}\vrr\int_{V} d^{3} \vrr' \int \frac{d^{3}\vk}{(2\pi)^3}\int \frac{d^{3}\vk'}{(2\pi)^3}\vs
&& e^{i(\vk\cdot\vrr+\vk'\cdot\vrr')-i(\vk_s\cdot\vrr+\vk_s'\cdot\vrr')} \frac{D_{\ini}}{D_{1}(a(r))} \frac{D_{\ini}}{D_{1}(a(r'))}  \vs
&\times &\langle \delta_{\rm m}^{(1)}(\vk;a(r))\delta_{\rm m}^{(2)}(\vk';a(r')) \rangle \eql{od}
\eea 
We have computed $\langle \delta_{\rm m,ini}^{(1)}(\vk)\delta_{\rm m,ini}^{(2)}(\vk') \rangle$ in our previous work, the result gives:
\be
\langle \delta_{\rm m,ini}^{(1)}(\vk)\delta_{\rm m,ini}^{(2)}(\vk') \rangle =2F_{2}(-\vk,\vk+\vk')P_{\rm m,ini}(k)\delta_{\rm m,ini}^{(1)}(\vk+\vk') 
\ee
$P_{\rm m,ini}$ is the linear matter power spectrum at some initial time $a_{\rm ini}$. We can use this result to further determine the value of the bracket in \ec{od}:
\bea 
&&\langle \delta_{\rm m}^{(1)}(\vbk;a(r))\delta_{\rm m}^{(2)}(\vbkp;a(r')) \rangle \vs
&=&2\frac{D_{1}(a(r))}{D_{\ini}}\bigg[\frac{D_{1}(a(r'))}{D_{\ini}} \bigg]^{2}\langle \delta_{\rm m,ini}^{(1)}(\vbk)\delta_{\rm m,ini}^{(2)}(\vbkp) \rangle  \vs 
&=&2\bigg[\frac{D_{1}(a(r'))}{D_{\ini}} \bigg]^{2}F_{2}(-\vbk,\vbk+\vbkp)P_{\rm m,\ini}(\bk)\delta_{\rm m}^{(1)}(\vbk+\vbkp;a(r)) \eql{odb} \vs
\eea 
where we use the definition of the the linear growth factor $D_1(a(r))$ twice. Plugging \ec{odb} into \ec{od}, we can see that the only $\vrr'$ dependent integral can be written as (here we simply choose a cube volume):
\be 
\int_{V} d^{3}\vrr'e^{-i(\vbkp-\vk_s')\vrr'}\frac{D_{1}(a(r'))}{D_{\ini}}  \simeq C\,(2\pi)^3\delta_{\rm D}(\vbkp-\vk_s')\eql{dt}
\ee 
since $D_1(a(r'))$ is a slowly varying function. $C$ is a constant and can be further determined via integrating over $\vbk$ on both sides of \ec{dt}, which gives:
\be 
C=\frac{D_{1}(a=1)}{D_{\rm ini}}
\ee 
thus:
\bea 
&& \langle \delta^{\rm LC,(1)}_{\rm m}(\vk_s)\delta^{\rm LC,(2)}_{\rm m}(\vk_s') \rangle \vs 
&=&2C\int_{V} d^{3} \vrr\int \frac{d^{3}\vbk}{(2\pi)^3}F_2(\vk,-\vk+\vk_s')P_{\rm m,\ini}(|\vk-\vk_s'|) \vs
&&\times \frac{D_{\ini}}{D_{1}(a(r))}e^{-i(\vk-\vk_s-\vk_s')\vrr}\delta_{\rm m}^{(1)}(\vk;a(r)) \vs
&\simeq & 2C\,F_{2}(-\vk_s,\vk_s+\vk_s')P_{\rm m,\ini}(k_s) \vs
&& \times \int_{V} d^{3} \vrr\int \frac{d^{3}\vbk}{(2\pi)^3}\frac{D_{\ini}}{D_{1}(a(r))}e^{-i(\vk-\vk_s-\vk_s')\vrr}\delta_{\rm m}^{(1)}(\vk;a(r))\vs
&= &2C\,F_{2}(-\vk_s,\vk_s+\vk_s')P_{\rm m,\ini}(k_s)\delta_{\rm m}^{\rm LC,(1)}(\vk_s+\vk_s')
\eea 
where in the first step, we perform a redefinition of integration dummy variable. And we use an approximation in the second step in order to get the first order term $\delta_{\rm m}^{\rm LC,(1)}(\vk_l)$ from the integral. 

Again, we have proved that with this construction in \ec{LC}, we can get long-wavelength modes from off-diagonal terms of short-wavelength modes:
\be 
\langle \delta^{\LC}_{\rm m}(\vk_s)\delta^{\LC}_{\rm m}(\vk_s') \rangle|_{\vk_s+\vk_s'=\vk_l} =\mathpzc{f}(\vec{k}_s,\vec{k}_s'){\delta}^{\rm LC,(1)}_{\rm m}(\vec{k}_l) \eql{2pt}
\ee 
with 
\bea
\mathpzc{f}(\vec{k}_s,\vec{k}_s')&=&2C\,F_2(-\vec{k}_s,\vec{k}_s+\vec{k}_s')P_{\rm m,ini}(k_s)\vs
&+&2C\,F_2(-\vec{k}_s',\vec{k}_s+\vec{k}_s')P_{\rm m,ini}(k_s')       
\eea 

The quadratic estimator can be formed as:
\be
\hat{\delta}^{\rm LC,(1)}_{\rm m}(\vk_l)=\mathpzc{A}(\vk_l)\int \frac{d^{3}\vk_s}{(2\pi)^3} \mathpzc{g}(\vk_s,\vk_s')\delta^{\LC}_{\rm m}(\vk_s)\delta^{\LC}_{\rm m}(\vk_s') \eql{est}
\ee 
with $\vk_s' = \vk_l-\vk_s$ and $\mathpzc{g}$ being a weighting function. $\mathcal{A}$ is the normalization function determined similarly by requiring that $\langle \hat{\delta}^{\rm LC,(1)}(\vec{k}_l) \rangle={\delta}^{\rm LC,(1)}(\vec{k}_l)$:
\begin{eqnarray}
\mathpzc{A}(\vec{k}_l)=\bigg[\int \frac{d^3 \vec{k}_s}{(2\pi)^3} \mathpzc{g}(\vec{k}_s,\vec{k}_s')\mathpzc{f}(\vec{k}_s,\vec{k}_s')  \bigg]^{-1} \eql{a}
\end{eqnarray}
Similar to our last work, $\mathpzc{g}$ can be calculated by minimizing the noise term and the result is:
\begin{eqnarray}
&&\mathpzc{g}(\vec{k}_{s},\vec{k}_{s}')
=\frac{\mathpzc{f}(\vec{k}_{s},\vec{k}_{s}')}{2P^{\rm LC}_{\rm m}(k_{s})P^{\rm LC}_{\rm m}(k_{s}')}\vs
&=&C\frac{F_2(-\vec{k}_s,\vec{k}_s+\vec{k}_s')P_{\rm m,ini}(k_s)+F_2(-\vec{k}_s',\vec{k}_s+\vec{k}_s')P_{\rm m,ini}(k_s')}{P^{\rm LC}_{\rm m}(k_{s})P^{\rm LC}_{\rm m}(k_{s}')}\vs 
\end{eqnarray} 
with this choice of $\mathpzc{g}$ the noise term $\mathpzc{N}$ is identical to the normalization factor $\mathpzc{A}$. And the projected detectability is defined similarly as \ec{error}:
\be
\frac{1}{\sigma^{\rm LC}(k_l)^2}=\frac{V k_l^2 \Delta k }{(2\pi)^2}\bigg[\frac{P_{\rm m,lin}(k_l)}{P_{\rm m,lin}(k_l)+A(k_l) }\bigg]^2 \eql{error1},
\ee

\section{Demonstration with N-body simulation II} \label{sec6}
\noindent We use the MICE Grand Challenge light-cone N-body simulation (MICE-GC) \cite{Fosalba:2015MI}\cite{Fosalba:2015MII} to demonstrate the power of the estimator in a light cone. The catalog contains one octant of the full sky up to $z = 1.4$ (comoving distance $3072\, h^{-1}\, \rm Mpc$) without simulation box repetition. We use the largest cube that can be fit into the octant as the region $V$ of integration in \ec{LCM}, as shown in Fig.~\rf{Cube}. This simulation used a flat $\Lambda$CDM model with cosmological parameters $ \Omega_{\rm m}=0.25$, $\sigma_8 = 0.8$, $n_{\rm s}=0.95$, $\Omega_{\rm b}=0.044$, $\Omega_{\Lambda}=0.75$, $h=0.7$. We also assume $D_{\ini}=1$ throughout this section.

\Sfig{Cube}{Boxsize of the cube is $L=3072/\sqrt{3}\, h^{-1}\, \rm Mpc\sim 1774\, h^{-1}\, \rm Mpc$. Volume is $V=L^3\sim 5.6\,(h^{-1}\,\rm Mpc)^3$. Only one point in the cube can reach the redshift of $1.4$, and $z=0$ is at the origin $O$ of the octant.}

We first extract $1$ in $700$  matter particles' positions in the full the light cone of MICE-GC simulation and then focus on the largest cube within it. This corresponds to $\sim 5.14\times 10^{7}$ particles in total each with $2.9\times 10^{10} h^{-1}M_{\odot}$ particle mass. 

\Sfig{real_dm}{Comparison of the true density field of the $1$ in $700$ matter particles of the Mice-GC simulation ($\delta^{\rm LC}_{\rm m}(\vrr)$, top row) and the density field from the quadratic estimator ($\hat{\delta}_{\rm m}^{\rm LC}(\vrr)$, middle row). The bottom row shows their difference. Each panel represents a slice through the simulation volume, $1774\,h^{-1}\rm \, Mpc$ wide, and one cell $\sim 253\,h^{-1}\rm \, Mpc$ thick. The integration range of $\vk_{s}$ is from $0.03\, h \rm \, Mpc^{-1}$ to $0.22\, h \rm \, Mpc^{-1}$.}

Then we consider the halo catalog in the same light cone with halo masses between $5 \times 10^{12}h^{-1}M_{\odot}<M < 10^{13}h^{-1}M_{\odot}$ for brevity. We have similar results in other mass bins too. We use \ec{hm} as the approximated matter density contrast and substitute it into \ec{LC}, with linear bias $b_{1}$ being a function of both halo mass and redshift. 

\Sfig{real_halo}{Comparison of the true density field of the halo number density contrast in mass bin $5 \times 10^{12}h^{-1}M_{\odot}<M < 10^{13}h^{-1}M_{\odot}$ of the Mice-GC simulation ($\delta^{\rm LC}_{\rm m}(\vrr)$, top row) and the density field from the quadratic estimator ($\hat{\delta}_{\rm m}^{\rm LC}(\vrr)$, middle row) in the same light cone as Fig.~\rf{real_dm}, and their difference (bottom row). The integration range of $\vk_{s}$ is from $0.03\, h \rm \, Mpc^{-1}$ to $0.22\, h \rm \, Mpc^{-1}$.} 


\acknowledgements
We thank Duncan Campbell and Rachel Mandelbaum for resourceful discussions. We also thank Enrique Gaztanaga for providing us with the $1$ in $700$ matter particles' positions of Mice-GC simulation. This work is supp orted by U.S. Dept. of Energy contract DE-SC0019248 and NSF AST-1909193.
The BigMDPL simulation was performed at LRZ Munich within the PRACE project pr86bu. The CosmoSim database (\url{www.cosmosim.org}) providing the file access is a service by the Leibniz-Institute for Astrophysics Potsdam (AIP).
This work has made use of CosmoHub. CosmoHub has been developed by the Port d'Informació Científica (PIC), maintained through a collaboration of the Institut de Física d'Altes Energies (IFAE) and the Centro de Investigaciones Energéticas, Medioambientales y Tecnológicas (CIEMAT), and was partially funded by the "Plan Estatal de Investigación Científica y Técnica y de Innovación" program of the Spanish government.
\clearpage
\bibliography{refs}

\appendix

\section{Non-cube Volume}
For a more generic case, we might have a non-cube volume. Thus:
\be
\delta^{\LC}_{\rm m}(\vk) :=\int_{V} d^3\vrr  \, \delta_{\rm m}(\vrr;a(r))\big[ \frac{D_{\ini}}{D_{1}(a(r))} \big]^{2}f_{V}(\vrr) e^{-i\vk \cdot\vrr}
\ee
 $f_{V}$ is a position-dependent function and its form will be fully determined by the light cone's shape. For a cube volume, simply we have $f_V=1$.

\end{document}
